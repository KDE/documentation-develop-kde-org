{{ define "main" }}
<div class="td-content">
  <h1 class="mt-2">{{ .Title }}</h1>
  {{ with .Params.description }}<div class="lead">{{ . | markdownify }}</div>{{ end }}
  {{ if (and (not .Params.hide_readingtime) (.Site.Params.ui.readingtime.enable)) }}
    {{ partial "reading-time.html" . }}
  {{ end }}
  {{ .Content }}
  <div class="section-index">
    {{ $parent := .Page }}
    {{ $allPages := .RegularPagesRecursive }}
    {{ $section := .Section }}
    {{ range .Params.groups }}
      <h2>{{ .name }}</h2>
      {{ with .description }}
         {{ . }}
      {{ end }}
      {{ if .subgroups }}
        {{ $key := .key }}
        {{ range .subgroups }}
          <h3>{{ .name }}</h3>
          {{ with .description }}
             {{ . }}
          {{ end }}
          {{ $pages := (where (where $allPages ".Params.group" $key ) ".Params.subgroup" .key).ByWeight  }}
          {{/* Otherwise we show a nice formatted list of subpages with page descriptions */}}
          <div class="row">
            {{ range $pages }}
              <div class="col-6 my-3">
                <a href="{{ .RelPermalink }}" class="ae-card d-block">
                  <h2 class="h4 mt-0">{{- .Title -}}</h2>
                  <p>{{ .Description | markdownify }}</p>
                </a>
              </div>
            {{ end }}
          </div>
        {{ end }}
      {{ else }}
        {{ $pages := (where $allPages ".Params.group" .key ).ByWeight  }}
        {{/* Otherwise we show a nice formatted list of subpages with page descriptions */}}
        <div class="row">
          {{ range $pages }}
            <div class="col-6 my-3">
              <a href="{{ .RelPermalink }}" class="ae-card d-block">
                <h2 class="h4 mt-0">{{- .Title -}}</h2>
                <p>{{ .Description | markdownify }}</p>
              </a>
            </div>
          {{ end }}
        </div>
      {{ end }}
    {{ end }}
  </div>
  <div class="text-muted mt-5 pt-3">{{ partial "page-meta-lastmod.html" . }}</div>
</div>
{{ end }}
